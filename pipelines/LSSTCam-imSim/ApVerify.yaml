# Pipeline for ap_verify on DC2
# This concatenates various lsst.verify metrics to an AP pipeline

description: Fully instrumented AP pipeline specialized for LSSTCam-imSim
imports:
  - location: $AP_VERIFY_DIR/pipelines/ApVerify.yaml
    # Include all metrics from standard pipeline. It's not practical to create
    # a metrics subset because it would require constant micromanagement.
    exclude:
      - apPipe
  - location: $AP_PIPE_DIR/pipelines/LsstCamImSim/ApPipe.yaml
tasks:
  # ApVerify override removed by excluding apPipe.
  diaPipe:
    class: lsst.ap.association.DiaPipelineTask
    config:
      doPackageAlerts: True
  transformDiaSrcCat:
    class: lsst.ap.association.TransformDiaSourceCatalogTask
    config:
      doIncludeSpuriousness: True
  rbClassify:
    class: lsst.meas.transiNet.RBTransiNetTask
    config:
      modelPackageName: 'rbResnet50-DC2'
      connections.coaddName: parameters.coaddName
contracts:
  # Must re-declare contracts that cross apPipe and metrics boundary, as
  # these were removed on import.
  # Use of ConnectionsClass for templated fields is a workaround for DM-30210
  - detectAndMeasure.connections.ConnectionsClass(config=detectAndMeasure).diaSources.name ==
      fracDiaSourcesToSciSources.connections.ConnectionsClass(config=fracDiaSourcesToSciSources).diaSources.name

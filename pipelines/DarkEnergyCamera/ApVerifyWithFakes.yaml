# Gen 3 pipeline for ap_verify
# This concatenates various lsst.verify metrics to an AP pipeline

# This pipeline assumes $AP_PIPE_DIR/pipelines/DarkEnergyCamera/RunIsrForCrosstalkSources.yaml
# has already been run.

instrument: lsst.obs.decam.DarkEnergyCamera
description: Fully instrumented AP pipeline with fakes, specialized for DECam
imports:
  - location: $AP_VERIFY_DIR/pipelines/ApVerifyWithFakes.yaml
  # Can't use $AP_PIPE_DIR/pipelines/DarkEnergyCamera/ApPipe.yaml here because
  # ApVerifyWithFakes changes task labels in order to set up parallel fakes
  # and non-fakes pipelines.
tasks:
  isr:
    class: lsst.ip.isr.IsrTask
    config:
      connections.ccdExposure: raw
      connections.crosstalkSources: overscanRaw
      doOverscan: true
      doCrosstalk: true
  calibrate:
    class: lsst.pipe.tasks.calibrate.CalibrateTask
    config:
      photoCal.match.referenceSelection.magLimit.fluxField: i_flux
      photoCal.match.referenceSelection.magLimit.maximum: 22.0
  processVisitFakes:
    class: lsst.pipe.tasks.processCcdWithFakes.ProcessCcdWithVariableFakesTask
    config:
      calibrate.photoCal.match.referenceSelection.magLimit.fluxField: i_flux
      calibrate.photoCal.match.referenceSelection.magLimit.maximum: 22.0
